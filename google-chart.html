<html>
  <head>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">
      // Load the Visualization API and the geochart package.
      google.charts.load('current', {
        'packages':['geochart'],
        // Note: you will need to get a mapsApiKey for your project.
        // See: https://developers.google.com/chart/interactive/docs/basic_load_libs#load-settings
        'mapsApiKey': 'AIzaSyBcthrNRW03wPUBu912Zq9Hru5p0kc9eHg'
      });
      // Set a callback to run when the Google Visualization API is loaded.
      google.charts.setOnLoadCallback(drawRegionsMap);

      function drawRegionsMap() {
        // Fetch the CSV data
        fetch('https://github.com/dendroenydris/dendroenydris.github.io/WHR2024.csv')
          .then(response => response.text())
          .then(csv => {
            // Convert CSV to array of objects
            var arrayData = csvToArray(csv);
            // Prepare DataTable
            var data = new google.visualization.DataTable();
            data.addColumn('string', 'Country'); // Country name
            data.addColumn('number', 'Ladder Score'); // Ladder score
            
            // Map CSV data to geo chart format
            var rows = arrayData.map(function (row) {
              return [row['Country name'], parseFloat(row['Ladder score'])];
            });

            data.addRows(rows);

            // Set chart options
            var options = {
              colorAxis: {colors: ['#e7eff6', '#02386f']} // light blue to dark blue
            };

            // Instantiate and draw the chart.
            var chart = new google.visualization.GeoChart(document.getElementById('regions_div'));
            chart.draw(data, options);
          });
      }

      // Helper function to transform CSV to an array of objects (one per row)
      function csvToArray(str, delimiter = ',') {
        // Slice from start of data to the end of data
        // Split the rows at every new line
        const rows = str.slice(str.indexOf('\n') + 1).split('\n');
        // Map every row to an array splitted by delimiter
        return rows.map(row => {
          const values = row.split(delimiter);
          const el = values.reduce((object, curr, i) => {
            object[rows[0].split(delimiter)[i]] = curr;
            return object;
          }, {});
          return el;
        });
      }
    </script>
  </head>

  <body>
    <!--Div that will hold the geo chart-->
    <div id="regions_div" style="width: 900px; height: 500px;"></div>
  </body>
</html>